<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="/js/kodumaro.js"></script>
<script language="javascript">
//<@[CDATA[
    document.title += ' :: MoonScript sobre LuaJIT';
//]]></script>

<div class="panel panel-default">
    <div class="panel-heading">
        <h2 class="mg-title">Kodumaro :: Instalando MoonScript sobre LuaJIT</h2>
    </div>
    <div class="panel-body">
        <img src="/img/moonscript.jpg" class="pull-right" alt="" />
        <p class="mg-first">
            H√° muito pouco tempo atr√°s um amigo meu me sugeriu dar
            aten√ß√£o a <a href="http://moonscript.org/">MoonScript</a>.
            Admito que eu via a linguagem com preconceito, mesmo assim
            resolvi dar uma olhada.
        </p>
        <p>
            Resultado: todos os meus c√≥digos em
            <a href="http://www.lua.org/">Lua</a> acabaram convertidos para
            MoonScript. üòã
        </p>
        <p>
            A linguagem √© extremamente enxuta, limpa e poderosa. Para lidar com
            o paradigma funcional, a sintaxe de MoonScript √© bem mais concisa e
            que a de Lua. O mesmo vale para orienta√ß√£o a objetos. N√£o vou entrar
            em detalhes, se estiver curioso, leia o
            <a href="http://moonscript.org/reference/">guia da linguagem</a>.
        </p>

        <h3>LuaJIT</h3>
        <p>
            <a href="http://luajit.org/">LuaJIT</a> √© uma implementa√ß√£o
            alternativa <a href="https://pt.wikipedia.org/wiki/JIT">JIT</a> de
            Lua, com suporte
            <a href="https://pt.wikipedia.org/wiki/Interface_de_fun√ß√£o_externa">FFI</a>
            nativo.
        </p>
        <p>
            Colocar MoonScript para trabalhar com LuaJIT n√£o √© trivial. √â
            preciso uma s√©rie de pequenos hacks pra funcionar.
        </p>
        <p>
            Vamos come√ßar pelas depend√™ncias.
        </p>

        <h3>Depend√™ncias</h3>
        <p>
            MoonScript depende de quatro outros m√≥dulos para funcionar:
        </p>
        <ul class="list-group">
            <li class="list-group-item">
                <span class="glyphicon glyphicon-hand-right"></span>
                <a href="http://luaforge.net/projects/alt-getopt/"><code>alt-getopt</code></a>
            </li>
            <li class="list-group-item">
                <span class="glyphicon glyphicon-hand-right"></span>
                <a href="http://keplerproject.github.io/luafilesystem/">>LuaFileSystem</a>
            </li>
            <li class="list-group-item">
                <span class="glyphicon glyphicon-hand-right"></span>
                LPeg
            </li>
        </ul>
        <p>
            Instale <code>alt-getopt</code> normalmente no <code>LUA_PATH</code>
            de seu LuaJIT. Aqui para mim √© <code>/usr/share/lua/jit</code>.
        </p>
        <p>
            Para instalar LuaFileSystem, clone o reposit√≥rio do
            <a href="https://github.com/keplerproject/luafilesystem">GitHUB</a>
            e n√£o se esque√ßa de editar o arquivo <code>config</code>. As
            mudan√ßas principais s√£o:
        </p>
        <pre class="prettyprint"><code class="language-sh">PREFIX=/usr
LUA_LIBDIR=$(PREFIX)/lib/lua/jit
LUA_INC=$(PREFIX)/include/luajit-2.0</code></pre>

        <p>
            Isso considerando que seu <code>LUA_CPATH</code> esteja em
            <code>/usr/lib/lua/jit</code>.
        </p>
        <p>
            Compile e instale normalmente.
        </p>
        <p>
            J√° LPeg merece uma aten√ß√£o extra, j√° que ele <strong>n√£o</strong>
            funciona com LuaJIT. No lugar, use
            <a href="https://github.com/sacek/LPegLJ">LPegLJ</a>.
        </p>
        <p>
            Clone e instale LPegLJ no seu <code>LUA_PATH</code>, depois execute
            o seguinte comando:
        </p>
        <pre class="prettyprint"><code class="language-sh">cd $LUA_PATH
sudo ln -s lpeglj.lua lpeg.lua</code></pre>

        <p>
            Isso far√° com que MoonScript pense tratar-se do LPeg original.
        </p>

        <h3>Instalando MoonScript</h3>
        <p>
            Com as tr√™s depend√™ncias instaladas, clone o projeto do
            <a href="https://github.com/leafo/moonscript">GitHUB</a>. Edite o
            <code>Makefile</code>, substituindo as ocorr√™ncias de
            <code>lua5.1</code> e <code>lua</code> por <code>luajit</code>.
        </p>
        <p>
            Remova as entradas <code>local</code> e <code>global</code> do
            <code>Makefile</code>.
        </p>
        <p>
            Edite o <em>hashbang</em> dos arquivos <code>bin/moon</code> e
            <code>bin/moonc</code> trocando <code>lua</code> por
            <code>luajit</code>.
        </p>
        <p>
            Execute <code>make compile</code>.
        </p>
        <p>
            Copie os diret√≥rios <code>moon/</code> e <code>moonscript/</code>
            para seu <code>LUA_PATH</code>.
        </p>
        <p>
            Copie os arquivos <code>bin/moon</code> e <code>bin/moonc</code>
            para o diret√≥rio <code>/usr/bin</code> do sistema.
        </p>
        <p>
            E pronto! J√° deve estar funcionando! Qualquer d√∫vida, me avisem pra
            eu revisar o texto.
        </p>

        <h3>P.S.</h3>
        <p>
            O artigo original foi publicado na
            <a href="http://kodumaro.blogspot.com.br/2015/08/instalando-moonscript-sobre-luajit.html">
            primeira vers√£o do Kodumaro</a> em 8 de agosto de 2015.
        </p>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-body" align="right">
        <small><a href="https://github.com/cacilhas/cacilhas.github.io/issues/new?title=Kodumaro+::+MoonScript+sobre+LuaJIT" target="_blank">Criar
                <em>issue</em></a></small>
    </div>
</div>
