<!DOCTYPE html><html lang="pt"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatibile" content="IE=edge"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Cache-Control" content="no-cache"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="author" content="‚Ñúodrigo Arƒ•imedeœÇ ‚Ñ≥ontegasppŒ± ‚Ñ≠acilhŒ±œÇ"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/ie10-viewport-bug-workaround.css"><link rel="stylesheet" href="/css/bootstrap-theme.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="stylesheet" href="/css/cacilhas.css"><title>Kodumaro :: MoonScript sobre LuaJIT</title><link rel="alternate" type="application/atom+xml" title="Kodumaro" href="http://cacilhas.info/kodumaro/feed.xml"><link rel="stylesheet" href="/css/kodumaro.css"><link rel="icon" href="/img/kodumaro.ico"><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script><script src="/js/ie-emulation-modes-warning.js"></script><script src="/js/jquery.min.js"></script><script src="/js/handle-old-url.js"></script></head><body><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-togge="collapse" data-target="#navbar" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">‚Ñ≠acilhŒ±œÇ.INFO</a></div><div id="navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="/">In√≠cio</a></li><li><a href="/about.html">Sobre</a></li><li><a href="http://cacilhas.info/kodumaro/">Kodumaro</a></li><li class="active"><a href=".">MoonScript sobre LuaJIT</a></li></ul></div></div></nav><div class="container"><div class="panel panel-default"><div class="panel-heading"><h2 class="mg-title">Kodumaro :: MoonScript sobre LuaJIT</h2><h6 class="pull-right">Publicado em 2016-05-12</h6><h6>As sombras da programa√ß√£o.</h6></div><div class="panel-body"><img src="/img/moonscript.jpg" alt="MoonScript" class="pull-right"><p class="mg-first">H√° muito pouco tempo atr√°s um amigo meu me sugeriu dar aten√ß√£o a <a href="http://moonscript.org/">MoonScript</a>. Admito que eu via a linguagem com preconceito, mesmo assim resolvi dar uma
olhada.</p><p>Resultado: todos os meus c√≥digos em <a href="http://www.lua.org/">Lua</a> acabaram migrados para MoonScript. üòã</p><p>A linguagem √© extremamente enxuta, limpa e poderosa. Para lidar com o
paradigma funcional, a sintaxe de MoonScript √© bem mais concisa e que a de
Lua. O mesmo vale para orienta√ß√£o a objetos. N√£o vou entrar em detalhes, se
estiver curioso, leia o <a href="http://moonscript.org/reference/">guia da linguagem</a>.</p><h3>LuaJIT</h3><p><a href="http://luajit.org/">LuaJIT</a> √© uma implementa√ß√£o alternativa <a href="https://pt.wikipedia.org/wiki/JIT">JIT</a> de Lua, com suporte a <a href="https://pt.wikipedia.org/wiki/Interface_de_fun√ß√£o_externa">FFI</a> nativo.</p><p>Colocar MoonScript para trabalhar com LuaJIT n√£o √© trivial. √â preciso uma s√©rie de pequenos <em>hacks</em> pra funcionar.</p><p>Vamos come√ßar pelas depend√™ncias.</p><h3>Depend√™ncias</h3><p>MoonScript depende de quatro outros m√≥dulos para funcionar:</p><ul class="list-group"><li class="list-group-item"><span class="glyphicon glyphicon-hand-right"></span> <a href="http://luaforge.net/projects/alt-getopt/"><code>alt-getopt</code></a></li><li class="list-group-item"><span class="glyphicon glyphicon-hand-right"></span> <a href="http://keplerproject.github.io/luafilesystem/">LuaFileSystem</a></li><li class="list-group-item"><span class="glyphicon glyphicon-hand-right"></span> LPeg</li></ul><p>Instale <code>alt-getopt</code> normalmente no <code>LUA_PATH</code> de seu LuaJIT. Aqui para mim √© <code>/usr/share/lua/jit</code>.</p><p>Para instalar LuaFileSystem, clone o reposit√≥rio do <a href="https://github.com/keplerproject/luafilesystem">GitHUB</a> e n√£o se esque√ßa de editar o arquivo <code>config</code>. As mudan√ßas
principais s√£o:</p><pre class="prettyprint"><code class="language-sh">PREFIX=/usr
LUA_LIBDIR=$(PREFIX)/lib/lua/jit
LUA_INC=$(PREFIX)/include/luajit-2.0
</code></pre><p>Isso considerando que seu <code>LUA_CPATH</code> esteja em <code>/usr/lib/lua/jit</code>.</p><p>Compile e instale normalmente.</p><p>J√° LPeg merece uma aten√ß√£o extra, j√° que ele <strong>n√£o</strong> funciona comLuaJIT. No lugar, use <a href="https://github.com/sacek/LPegLJ">LPegLJ</a>.</p><p>Clone e instale LPegLJ no seu <code>LUA_PATH</code>, depois execute o seguinte comando:</p><pre class="prettyprint"><code class="language-sh">cd $LUA_PATH
sudo ln -s lpeglj.lua lpeg.lua
</code></pre><p>Isso far√° com que MoonScript pense tratar-se do LPeg original.</p><h3>Instalando MoonScript</h3><p>Com as tr√™s depend√™ncias instaladas, clone o projeto do <a href="https://github.com/leafo/moonscript">GitHUB</a>. Edite o <code>Makefile</code>, substituindo as ocorr√™ncias de <code>lua5.1</code> e <code>lua</code> por <code>luajit</code>.</p><p>Remova as entradas <code>local</code> e <code>global</code> do <code>Makefile</code>.</p><p>Edite o <em>hashbang</em> dos arquivos <code>bin/moon</code> e <code>bin/moonc</code>, trocando <code>lua</code> por <code>luajit</code>.</p><p>Execute <code>make compile</code></p><p>Copie os diret√≥rios <code>moon/</code> e <code>moonscript/</code> para seu <code>LUA_PATH</code>.</p><p>Copie os arquivos <code>bin/moon</code> e <code>bin/moonc</code> para o diret√≥rio <code>/usr/bin/</code> do sistema.</p><p>E pronto! J√° deve estar funcionando! Qualquer d√∫vida, me avisem pra eu
revisar o texto.</p></div></div><div class="panel panel-default"><div font-size="small" class="panel-body"><div id="disqus_thread"></div><script language="javascript">var disqus_config = function() {
  this.page.url = 'http://cacilhas.info/kodumaro/2016/05/moonscript.html'
  this.page.identifier = '2016.05.moonscript'
}</script><noscript>Por favor habilite o JavaScript para ver os <a href="https://disqus.com/?ref_noscript">coment√°rios do Disqus</a>.</noscript></div></div></div><div id="footer" class="panel-footer"><p class="small">Autor: Arƒ•imedeœÇ ‚Ñ≥ontegasppŒ± ‚Ñ≠acilhŒ±œÇ &nbsp;<a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt"><img alt="[CC-BY 4.0]" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a></p></div><script src="/js/bootstrap.min.js"></script><script src="/js/ie10-viewport-bug-workaround.js"></script><script src="/js/kodumaro.disqus.js"></script><script id="dsq-count-scr" src="//kodumaro.disqus.com/count.js" async></script></body></html>