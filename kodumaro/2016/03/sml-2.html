<!DOCTYPE html><html lang="pt"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatibile" content="IE=edge"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Cache-Control" content="no-cache"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="author" content="ℜodrigo Arĥimedeς ℳontegasppα ℭacilhας"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/ie10-viewport-bug-workaround.css"><link rel="stylesheet" href="/css/bootstrap-theme.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="stylesheet" href="/css/cacilhas.css"><title>Kodumaro :: Standard ML – continuação</title><link rel="alternate" type="application/atom+xml" title="Kodumaro" href="http://cacilhas.info/kodumaro/feed.xml"><link rel="stylesheet" href="/css/kodumaro.css"><link rel="icon" href="/img/kodumaro.ico"><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script><script src="/js/ie-emulation-modes-warning.js"></script><script src="/js/jquery.min.js"></script><script src="/js/handle-old-url.js"></script></head><body><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-togge="collapse" data-target="#navbar" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">ℭacilhας.INFO</a></div><div id="navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="/">Início</a></li><li><a href="/about.html">Sobre</a></li><li><a href="http://cacilhas.info/kodumaro/">Kodumaro</a></li><li class="active"><a href=".">Standard ML – continuação</a></li></ul></div></div></nav><div class="container"><div class="panel panel-default"><div class="panel-heading"><h2 class="mg-title">Kodumaro :: Standard ML – continuação</h2><h6 class="pull-right">Publicado em 17 de Fevereiro, 2016</h6><h6>As sombras da programação.</h6></div><div class="panel-body"><p class="mg-first">No <a href="http://cacilhas.info/kodumaro/2016/03/sml.html">artigo anterior</a> vimos como criar funções que retornem uma sequência de inteiros. Porém,
para estendê-las para gerarem uma sequência de caracteres, por exemplo,
teríamos de reescrever o código.</p><p>Neste artigo mudaremos o código para torná-lo estensível a outros tipos usando um <em>functor</em>.</p><p>Módulos em Standard ML são chamados <em>structures</em> e podem ser instanciados sob demanda com o uso de <em>functors</em>. A primeira coisa que precisamos é da assinatura dos módulos gerados pelo <em>functor</em>.</p><p>Os módulos gerados precisam ter o tipo de dado (<code>t</code>), uma função para construir o gerador (<code>build</code>) e outra para converter o gerador em lista (<code>genToList</code>). A assinatura fica assim então:</p><pre class="prettyprint"><code class="language-ml">signature GENERATOR =
sig
  eqtype t
  val genToList : (unit -&gt; t option) -&gt; t list
  val build : (t * t) -&gt; unit -&gt; t option
end
</code></pre><p>Também precisamos da assinatura da <em>structure</em> usada como parâmetro do <em>functor</em>. Essa <em>structure</em> deve gerenciar a reiteração dos dados. Para tanto, deve conhecer o tipo de dado (<code>t</code>), ter uma função para fazer o passo, ou seja, incrementar o dado (<code>increment</code>), e outra para testar a condição de parada (<code>checkFinish</code>).</p><p>A assinatura fica assim então:</p><pre class="prettyprint"><code class="language-ml">signature GENERATOR' =
sig
  eqtype t
  val increment : t ref -&gt; unit
  val checkFinish : t ref -&gt; t -&gt; bool
end
</code></pre><p>O <em>functor</em> terá praticamente o mesmo código de nossas funções originais, mas agora será extensível.</p><p>Vamos então trazer o código para o <em>functor</em>:</p><pre class="prettyprint"><code class="language-ml">functor Generator (G : GENERATOR') : GENERATOR =
struct
  type t = G.t

  val genToList =
    let
      fun genToList' (acc : t list) (gen : unit -&gt; t option) : t list =
        case gen () of NONE       =&gt; rev acc
                     | SOME value =&gt; genToList' (value::acc) gen
    in
      genToList' nil
    end

  local
    fun build' i finish () =
      if G.checkFinish i finish then
        NONE
      else
        let
          val r = !i
        in
          G.increment i;
          SOME r
        end
  in
    fun build (start, finish) = build' (ref start) finish
  end
end
</code></pre><p>Repare que agora em vez de <code>int</code> estamos usando <code>t</code> (que é igual a <code>G.t</code>), e delegamos a verificação do fim da reiteração e o incremento da referência para <code>G</code>.</p><p>Resta agora recriar nossas funções originais. Como só nos interessam <code>xrange</code> e <code>range</code>, podemos criar a <code>structure</code> como <code>local</code>:</p><pre class="prettyprint"><code class="language-ml">local
  structure IntGenerator = Generator (struct
    type t = int

    fun increment v : unit = v := !v + 1
    and checkFinish i finish = !i &gt;= finish
  end)
in
  val xrange = IntGenerator.build
  val range = IntGenerator.genToList o xrange
end
</code></pre><p>E para criar funções equivalentes para caracteres? A lógica é a mesma:</p><pre class="prettyprint"><code class="language-ml">local
  structure StringGenerator = Generator (struct
    type t = char

    fun increment v : unit = v := chr (ord (!v) + 1)
    and checkFinish (i : char ref) (finish : char) = !i &gt; finish
  end)
in
  val xcharseq = StringGenerator.build
  val strseq = implode o StringGenerator.genToList o StringGenerator.build
end
</code></pre><p>Veja que agora podemos com facilidade estender o lógica de criação de geradores para virtualmente qualquer tipo, com a ajuda do <em>functor</em>.</p></div></div><div class="panel panel-default"><div class="panel-body"><div id="disqus_thread"></div><script language="javascript">var disqus_config = function() {
  this.page.url = 'http://cacilhas.info/kodumaro/2016/03/sml-2.html'
  this.page.identifier = '2016.03.sml-2'
  this.page.title = 'Standard ML – continuação'
}</script><noscript>Por favor habilite o JavaScript para ver os <a href="https://disqus.com/?ref_noscript">comentários do Disqus</a>.</noscript></div></div></div><div id="footer" class="panel-footer"><p class="small">Autor: Arĥimedeς ℳontegasppα ℭacilhας &nbsp;<a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt"><img alt="[CC-BY 4.0]" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a></p></div><script src="/js/bootstrap.min.js"></script><script src="/js/ie10-viewport-bug-workaround.js"></script><script src="/js/kodumaro.disqus.js"></script><script id="dsq-count-scr" src="//kodumaro.disqus.com/count.js" async></script></body></html>